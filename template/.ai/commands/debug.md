---
type: command
name: debug
description: バグ調査を支援し、根本原因の特定と修正案を提示する
usage:
  - /debug TypeError: Cannot read property 'x' of undefined
  - /debug ログイン後にセッションが切れる問題
  - /debug logs/error.log
---
# Debug Command

バグ調査を支援し、根本原因の特定と修正案を提示する。

## 使用方法

```bash
/debug TypeError: Cannot read property 'x' of undefined
/debug ログイン後にセッションが切れる問題
/debug logs/error.log
```

## 前提条件

以下を確認してから実行。満たさない場合は中止し理由を報告:

1. エラーメッセージ、症状、またはログファイルが提供されている
2. 関連するソースコードにアクセス可能

## 実行手順

### 1. 状況把握
- エラーメッセージ/スタックトレース分析
- 再現手順、発生頻度、影響範囲を確認
- 不明点があれば `[NEEDS CLARIFICATION: 質問]` を挿入（最大3箇所）

### 2. 原因特定
- エラー発生箇所と関連コード調査
- 仮説立案（直接原因 → 根本原因）
- ログ/デバッガで検証

### 3. 対応判定

| 種別 | 対応 |
|------|------|
| 単純バグ（タイポ、null未チェック等） | 即修正 + テスト追加 |
| 技術的負債（設計欠陥） | パッチ + docs/に記録 |

### 4. 結果出力
- 下記の出力形式に従って報告

## 出力形式

```markdown
# デバッグレポート

## 問題: [症状]
## 原因: 直接=[X]、根本=[Y]
## 判定: [単純バグ/技術的負債]

## 修正案
[具体的な修正内容]

## テスト追加
[追加すべきテストケース]

## 次のアクション
1. [ステップ]
```

## 成功基準

このコマンドの実行は以下を満たしたとき成功とみなす:

1. 直接原因と根本原因が明確に区別して特定されている
2. 修正案が具体的（ファイル名、行番号、コード例を含む）
3. 再発防止のためのテスト追加案が提示されている

## よくあるパターン

| エラー         | 原因               | 確認         |
| -------------- | ------------------ | ------------ |
| null/undefined | 初期化漏れ、非同期 | データフロー |
| 型エラー       | 型変換、API応答    | 入出力の型   |
| N+1            | eager loading不足  | クエリログ   |

## 完了チェックリスト

結果報告前に以下をすべて確認。未達成項目があれば修正してから報告:

- [ ] 前提条件をすべて満たした
- [ ] 直接原因と根本原因を明確に区別した
- [ ] 修正案が具体的（ファイル名、行番号、コード例）
- [ ] テスト追加案を含めた
- [ ] 出力形式に従っている
- [ ] `[NEEDS CLARIFICATION]` が残っている場合はユーザーに確認を求めた

## 原則

5 Whys、仮説駆動、最小再現
