# Context Update Command

このセッションを振り返り、コンテキストを更新してください。

## 実行手順

### Step 1: 抽出

この会話から保存すべき内容を特定：

**基本項目**
- 新しく学んだこと
- 設計判断とその理由
- 踏んだ落とし穴・注意点

**繰り返しパターンの検出**
- 同じ説明が3回以上出現している内容
- 同じ指摘が複数セッションにまたがって出現
- 「必ず」「常に」「絶対に」等の強調表現を含む内容

**コーディング規約の候補**
- コードレビューで繰り返し指摘されている問題
- 特定のパターンが複数回適用されている
- プロジェクト全体に影響するルール

**新規エージェント/コマンドの必要性**
- 同じワークフローが3回以上繰り返されている
- 既存エージェントでカバーされていない専門領域

### Step 2: 整合性チェック

既存コンテキストとの確認：
- 矛盾する記述がないか
- 重複する内容がないか
- 古くなった情報がないか

### Step 3: 圧縮判断

context.md の現在の行数を確認：
- 200行以下 → そのまま追記
- 200行超 → 追記前に圧縮を実施

### Step 4: 保存先の判断

| 種類 | 保存先 | 備考 |
|-----|-------|------|
| プロジェクト全般のルール | .ai/context.md | 高シグナル情報のみ |
| 確定した設計判断（ADR形式） | docs/decisions/ADR-xxx.md | → テンプレート参照 |
| 詳細なガイドライン | docs/guidelines/xxx.md | 手順・詳細説明 |
| 専門ワークフロー | .ai/agents/xxx.md | 新規エージェント |

### ADR（Architecture Decision Record）の作成基準

以下の場合は docs/decisions/ にADRを作成：
- アーキテクチャに影響する決定
- 複数の選択肢から1つを選んだ経緯
- 将来の開発者が「なぜこうなっているか」知る必要がある決定

ADRテンプレート: `.ai/references/templates/adr.md`

## 圧縮方針（必要な場合）

1. **重複の統合**: 同じ内容を1つに
2. **表現の簡潔化**: 冗長な説明を短縮
3. **参照化**: 詳細すぎる記述は docs/ へ分離し参照に置換
4. **削除**: 古くなった情報（削除より分離を優先）

## 出力形式

### 1. 変更サマリー
- 追加: [件数]
- 修正: [件数]
- 削除: [件数]
- 圧縮: [実施した/不要]
- ADR作成: [あり/なし]

### 2. 更新内容

#### context.md
[変更後の全文、または差分]

#### その他のファイル（必要な場合）
- ファイルパス: [パス]
- 内容: [追記内容]

## 注意事項

- 適切な抽象度を保つ（硬直的すぎず、曖昧すぎず）
- 重要な情報は必ず保持（削除より分離を優先）
- 分離した情報は参照リンクを残す
- Claudeが既知の概念（SOLID、DDD等）は「〜に準拠」で十分
