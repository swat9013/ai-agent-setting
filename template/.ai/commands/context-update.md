---
type: command
name: context-update
description: セッションを振り返り、コンテキストファイルを更新する
usage:
  - /context-update
---

# Context Update Command

セッションを振り返り、コンテキストを更新する。

## 前提

- `.ai/context.md` が唯一の真実の源（SSOT）
- `AGENTS.md`, `CLAUDE.md` 等は `sync-context.py` で自動生成される出力
- 編集は必ず `.ai/context.md` に対して行う

## 前提条件

以下を確認してから実行。満たさない場合は中止し理由を報告:

1. `.ai/context.md` が存在し読み込み可能
2. 保存すべき学びや設計判断がセッション内に存在する

## 実行手順

### 1. 抽出
保存すべき内容を特定：
- 新しく学んだこと、設計判断とその理由、落とし穴
- 3回以上繰り返された説明・指摘・ワークフロー
- コードレビューで繰り返し指摘された問題

### 2. 整合性チェック
- 矛盾・重複・古い情報がないか確認

### 3. 規模チェック
```bash
python3 .ai/scripts/measure-context.py
```
閾値超過時は追記前に圧縮。

### 4. 保存先判断

| 種類 | 保存先 |
|-----|-------|
| プロジェクト全般ルール | .ai/context.md |
| 設計判断（ADR形式） | docs/decisions/ |
| 詳細ガイドライン | docs/guidelines/ |
| 新規エージェント/コマンド | .ai/agents/ or .ai/commands/ |

ADRテンプレート: `.ai/references/templates/adr.md`

エージェント＝対話・相談向け、コマンド＝アクション実行。1:1対応ならコマンドに統合。

### 5. 同期
.ai/context.md 更新後は各ツール向けファイルを同期:
```bash
python3 .ai/scripts/sync-context.py
```
同期先: `AGENTS.md`, `CLAUDE.md`, `.cursor/`, `.github/instructions/`, `.claude/`

## 圧縮方針
1. 重複統合  2. 表現簡潔化  3. 詳細は docs/ へ分離  4. 古い情報は削除

## 出力形式
```
### 変更サマリー
- 追加/修正/削除: X件、圧縮: 実施/不要

### 更新内容
[差分または全文]
```

## 成功基準

このコマンドの実行は以下を満たしたとき成功とみなす:

1. セッションで得た学びが再利用可能な形で保存されている
2. .ai/context.mdが閾値内（200行以下推奨）に収まっている
3. 既存の内容と矛盾・重複がない

## 完了チェックリスト

結果報告前に以下をすべて確認。未達成項目があれば修正してから報告:

- [ ] 前提条件をすべて満たした
- [ ] 抽出内容が具体的で再利用可能
- [ ] 既存の内容と矛盾・重複がない
- [ ] 規模チェックを実行し、閾値内に収まっている
- [ ] 適切な保存先に振り分けた
- [ ] `sync-context.py` を実行した（または実行を促した）
- [ ] 出力形式に従っている

## 原則

- 最小限の高シグナル情報で効果最大化
- 適切な抽象度（硬直的すぎず曖昧すぎず）
- 実践に必要な知識のみ記載（歴史的経緯や比較用の対立概念は不要）
- 詳細リンクは分離時のみ追加
- AIが既知の概念は「〜に準拠」で十分
