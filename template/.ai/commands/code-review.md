# /code-review Command

コードレビューを実行し、カテゴリ別フィードバックを提供する。

## 使用方法

```bash
# 特定ファイルをレビュー
/code-review path/to/file.ts

# 特定ディレクトリをレビュー
/code-review src/features/auth/

# 現在の変更をレビュー（引数なし）
/code-review
```

## レビュー観点（優先順位順）

### 🔴 Critical: 即修正必須
- セキュリティ（インジェクション、XSS、認証・認可）
- データ整合性（外部キー、NOT NULL、トランザクション）
- ビジネスクリティカルなロジックの誤り

### 🟠 High: 早急に対応
- パフォーマンス（N+1クエリ、不要なクエリ）
- アーキテクチャ違反（層の逆転、循環依存）
- エラーハンドリング不足

### 🟡 Medium: 改善推奨
- 可読性（長すぎるメソッド/クラス、ネスト深すぎ）
- テスタビリティ（依存注入、モック可能性）
- Lint/静的解析の警告

### 🟢 Low: 余力があれば
- ドキュメント・コメント
- 命名の改善
- DRY原則（軽微な重複）

詳細チェックリスト: `.ai/references/checklists/code-review.md`

## 処理フロー

1. **対象の特定**
   - 引数あり → 指定されたファイル/ディレクトリ
   - 引数なし → `git diff` で変更されたファイル

2. **コンテキスト読み込み**
   - context.md の制約事項を確認
   - 関連する docs/ を参照

3. **自動チェック確認**
   - テスト結果
   - Lint/静的解析結果
   - ビルド結果

4. **マニュアルレビュー**
   - 🔴 Critical → 🟠 High → 🟡 Medium → 🟢 Low の順
   - 問題点と具体的な修正案を提示

## 出力形式

```markdown
# コードレビュー結果: [対象]

## 🔴 Critical: 即修正必須
- [ ] `file.ts:42` [問題説明]
  - 現状: [コード]
  - 修正: [改善案]

## 🟠 High: 早急に対応
...

## 🟡 Medium: 改善推奨
...

## 🟢 Low: 余力があれば
...

## 総評
- 指摘件数: Critical X件, High X件, Medium X件, Low X件
- 自動チェック: テスト [PASS/FAIL], Lint [PASS/FAIL]
- 次のアクション: [推奨事項]
```

## 注意事項

### 必ず守ること
- 優先順位を明確に（重要な問題から）
- 具体的な修正案を提示（「直して」ではなく「〜を〜に修正」）
- 根拠を示す（「SOLID原則では〜」「パフォーマンス面で〜」）

### 避けるべきこと
- 曖昧な指摘
- 主観的な好みの押し付け
- Lintで自動化できる指摘に時間をかける
- 過剰なレビュー（優先順位をつける）

## 関連

- チェックリスト: `.ai/references/checklists/code-review.md`
