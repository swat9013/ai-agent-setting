# Context Update Command

このセッションを振り返り、コンテキストを更新する。

## 前提条件

以下を確認してから実行。満たさない場合は中止し理由を報告:

1. `CLAUDE.md` が存在し読み込み可能
2. 保存すべき学びや設計判断がセッション内に存在する

## 対象ファイル

### このリポジトリ固有
- `CLAUDE.md` - テンプレート開発用コンテキスト
- `docs/design.md` - 設計書
- `docs/customization.md` - カスタマイズガイド

### テンプレート本体（導入先に配布される）
- `template/.ai/context.md` - メインコンテキスト
- `template/.ai/commands/*.md` - コマンド定義
- `template/.ai/agents/*.md` - エージェント定義

## 実行手順

### Step 1: 抽出
この会話から保存すべき内容を特定：
- テンプレート設計に関する新しい知見
- 開発方針の変更・追加
- 踏んだ落とし穴・注意点
- 普遍的に適用できるコーディング原則

### Step 2: 分類
抽出した内容を以下に分類：

| 分類 | 判断基準 | 例 |
|-----|---------|-----|
| リポジトリ固有 | テンプレート開発・運用に関する内容 | リリース手順、ファイル編集時の注意 |
| テンプレート反映 | 導入先プロジェクトでも適用される普遍的内容 | コーディング原則、コマンド改善 |
| 両方 | 両方に該当する原則 | コンテキスト設計の原則 |

### Step 3: 規模チェック

コンテキストの規模を計測：

```bash
python3 template/scripts/measure-context.py
```

閾値を超過している場合は追記前に圧縮を検討。

### Step 4: 整合性チェック
既存コンテキストとの確認：
- CLAUDE.md と矛盾する記述がないか
- template/.ai/ の内容との整合性
- docs/design.md との整合性
- 重複する内容がないか

### Step 5: 保存先の判断

**リポジトリ固有**

| 種類 | 保存先 |
|-----|-------|
| 開発方針・注意点 | CLAUDE.md |
| 設計の根本的な変更 | docs/design.md |
| 使い方の追加説明 | docs/customization.md |

**テンプレート反映**

| 種類 | 保存先 |
|-----|-------|
| 普遍的なコーディング方針 | template/.ai/context.md |
| コマンドの改善 | template/.ai/commands/*.md |
| エージェントの改善 | template/.ai/agents/*.md |

## 出力形式

### 1. 変更サマリー
- リポジトリ固有: [件数]
- テンプレート反映: [件数]

### 2. 更新内容

#### リポジトリ固有
[ファイルパスと差分]

#### テンプレート反映
[ファイルパスと差分]

## 完了チェックリスト

結果報告前に以下をすべて確認。未達成項目があれば修正してから報告:

- [ ] 前提条件をすべて満たした
- [ ] 抽出内容が具体的で再利用可能
- [ ] 既存の内容と矛盾・重複がない
- [ ] 規模チェックを実行した
- [ ] 適切な保存先に振り分けた
- [ ] 出力形式に従っている

## 成功基準

このコマンドの実行は以下を満たしたとき成功とみなす:

1. セッションで得た学びが再利用可能な形で保存されている
2. リポジトリ固有とテンプレート反映が適切に分類されている
3. 既存の内容と矛盾・重複がない

## 注意事項

- テンプレートの汎用性を維持（具体的すぎる例は避ける）
- 両方に該当する場合は両方に反映する
- 破壊的変更の場合はCHANGELOG.mdへの記載も検討
